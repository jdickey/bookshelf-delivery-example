#!/bin/bash

# This works for MRI; it may or may not work for other Rubies.
RUBY_VERSION=`ruby --version | cut -d ' ' -f 2 | sed 's/p.*//'`

##
## Initialise Gemset and setup if `rbenv` is available
##

rm -f Gemfile.lock
rm -f .rbenv-gemsets

if [[ `rbenv --version 2>/dev/null` ]]; then
  rbenv gemset delete $RUBY_VERSION ./tmp/gemset 2>/dev/null || true
  find ./tmp/gemset -delete 2>/dev/null || true
  rbenv rehash
  rbenv gemset create $RUBY_VERSION ./tmp/gemset
  echo ./tmp/gemset > .rbenv-gemsets
  # echo hanami >> .rbenv-gemsets
  rbenv rehash
fi

##
## Install Gems
##

gem install yard -v 0.9.15
yard config --gem-install-yri

# gem install mini_mime:1.0.0 # dependency of mail:2.7.0; no --no-doc required
# gem install mail:2.7.0 --no-doc # does not play nicely with YARD

gem install rake:11.3.0
gem install public_suffix:2.0.4 addressable:2.5.0
gem install byebug:9.0.6
gem install mini_portile2:2.1.0 nokogiri:1.7.1
gem install rack:1.6.5 rack-test:0.6.3

gem install mime-types-data:3.2016.0521 mime-types:3.1 xpath:2.0.0 capybara:2.10.1


gem install coderay:1.1.1 method_source:0.8.2 slop:3.6.0 pry:0.10.4

# dry-validation is a dependency of hanami-validations. All the other dry-rb
# Gems here(!) are direct/indirect dependencies of dry-validation.

gem install concurrent-ruby:1.0.2 dry-configurable:0.3.0 dry-container:0.5.0 \
            dry-core:0.2.0 dry-equalizer:0.2.0 dry-logic:0.4.0 \
            inflecto:0.0.2 dry-types:0.9.1 dry-validation:0.10.3

gem install hanami-utils:0.8.0 hanami-helpers:0.4.0 \
            tilt:2.0.5 hanami-assets:0.3.0 \
            hanami-controller:0.7.1 \
            mail:2.6.4 hanami-mailer:0.3.0 \
            url_mount:0.2.1 http_router:0.11.2 hanami-router:0.7.0 \
            hanami-validations:0.6.0 \
            hanami-view:0.7.0 \
            thor:0.19.1 hanami:0.8.0
gem install sequel:4.40.0 hanami-model:0.6.1

gem install minitest:5.9.1
gem install multi_json:1.12.1

gem install ast:2.3.0 parser:2.3.1.4 powerpack:0.1.1 rainbow:2.1.0 ruby-progressbar:1.8.1 \
            unicode-display_width:1.1.1 rubocop:0.45.0

gem install dotenv:2.1.1
gem install pg:0.19.0
gem install uber:0.0.15 representable:2.3.0 roar:1.0.4
gem install shotgun:0.9.2

bundle install --binstubs --local --with development,test
